# Avina Cluster Project

This project contains the complete infrastructure-as-code and deployment automation for the Avina cluster. It is designed for repeatable, secure, and flexible deployments across multiple environments and clients.

## Project Structure

-   `install/`: Contains the master interactive installation script and its documentation.
-   `environments/`: Holds configuration templates for different deployment environments (QA, Production).
-   `docker-compose.infra.yml`: Defines the core infrastructure services (NGINX, Certbot, MongoDB).
-   `docker-compose.apps.yml`: Defines the application services (n8n, etc.).
-   `nginx/`: Contains the NGINX configuration and Dockerfile.
-   `data/`: Stores persistent data volumes for services like MongoDB and n8n's main database.
-   `n8n/`: Contains n8n custom extensions and related configurations.
-   `browser/`: Holds directories for file `uploads` and `browser_downloads` used by services.
-   `certbot/`: Stores SSL certificates and Let's Encrypt account information.
-   `static/`: A location for any static HTML content you want NGINX to serve.

## Deployment

The primary method for deploying a new Avina environment is through the interactive installation script. This script handles system preparation, Docker installation, project deployment, and service configuration in one automated flow.

### Quick Start Guide

1.  **Copy Project to Server:**
    Transfer the entire project directory to the target Ubuntu server.

2.  **Run the Installer:**
    Navigate into the `install` directory and run the script with `sudo`.

    ```bash
    cd install/
    sudo ./install.sh
    ```

3.  **Follow the Prompts:**
    The script will guide you through a series of questions to configure the environment:
    -   Environment type (qa/prod)
    -   Client domain details
    -   Secure password for the database
    -   Usernames of administrators

The script will automatically perform all necessary setup, including acquiring the SSL certificate and launching the Docker containers.

### Manual Management

After the initial deployment, you can manage the stack from the deployment directory (`/srv/avina`) using standard Docker Compose commands.

-   **Start all services:**
    ```bash
    docker-compose -f docker-compose.infra.yml -f docker-compose.apps.yml up -d
    ```

-   **Stop all services:**
    ```bash
    docker-compose -f docker-compose.infra.yml -f docker-compose.apps.yml down
    ```

-   **View logs:**
    ```bash
    docker-compose -f docker-compose.infra.yml -f docker-compose.apps.yml logs -f
    ```

## Security

-   **Least Privilege:** The setup creates a dedicated `avina-admins` group for file permissions and relies on the `docker` group for container management, avoiding widespread `sudo` access.
-   **Secrets Management:** All sensitive values are managed in a `.env` file on the server, generated by the installer. This file should never be committed to version control.
-   **CRITICAL WARNING:** Users in the `docker` group have permissions equivalent to root on the host machine. Only add fully trusted administrators.
