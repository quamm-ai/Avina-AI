# Avina Cluster Project

This project contains the complete infrastructure-as-code and deployment automation for the Avina cluster. It is designed for repeatable, secure, and flexible deployments across multiple environments and clients.

## Project Structure

-   `install/`: Contains the master interactive installation script and its documentation.
-   `docker-compose.yml`: Defines all infrastructure and application services (Nginx, MongoDB, n8n).
-   `nginx/`: Contains Nginx configurations for both HTTP (temporary) and HTTPS (secure) modes.
-   `ssl/`: A placeholder for your custom SSL certificate and private key.
-   `data/`: Stores persistent data volumes for services like MongoDB and n8n.
-   `environments/`: Holds configuration templates for different deployment environments.
-   `n8n/`: Contains n8n custom extensions and related configurations.
-   `browser/`: Holds directories for file `uploads` and `downloads` used by services.
-   `static/`: A location for any static HTML content you want Nginx to serve.
-   `enable-ssl.sh`: A utility script to easily switch from HTTP to HTTPS mode after installation.

## Database Configuration
This project uses a hybrid database setup:
-   **n8n** uses **SQLite** for its internal database, which is simple and officially supported. The database file is persisted in the `data/n8n` directory.
-   **MongoDB** is included and available for any custom applications you choose to add to the cluster.

## Deployment
The primary method for deploying a new Avina environment is through the interactive installation script. This script handles system preparation, Docker installation, project deployment, and service configuration in one automated flow.

### SSL Configuration (IMPORTANT)
This project supports two modes for web traffic:
1.  **HTTP-Only (Default)**: If you run the installer without placing any files in the `ssl/` directory, the system will start in a temporary, insecure HTTP mode. This is ideal for initial setup and internal testing.
2.  **HTTPS (Secure)**: If you place your wildcard SSL certificate (`.crt`) and private key (`.key`) in the `ssl/` directory *before* running the installer, the system will start in a fully secure HTTPS mode.

You can easily switch from HTTP to HTTPS at any time after installation by placing your certificate files in `/srv/avina/ssl/` and running `sudo /srv/avina/enable-ssl.sh`.

### Quick Start Guide

1.  **Connect to your VM and Install Git:**
    Log into your new, clean Ubuntu VM and install Git.
    ```bash
    sudo apt-get update && sudo apt-get install git -y
    ```

2.  **Clone the Repository:**
    Clone the project from GitHub into a temporary location, like your home directory.
    ```bash
    cd ~
    git clone https://github.com/quamm-ai/Avina-AI.git
    ```
    
3.  **(Optional) Add SSL Certificate:**
    If you have your SSL certificate and key, place them in the `ssl/` directory now.
    ```bash
    cp /path/to/your/certificate.crt ~/Avina-AI/ssl/
    cp /path/to/your/private.key ~/Avina-AI/ssl/
    ```

4.  **Run the Installer:**
    Navigate into the `install` directory, make the script executable, and run it with `sudo`. The script will handle copying the project to its final destination (`/srv/avina`).
    ```bash
    cd ~/Avina-AI/install/
    chmod +x install.sh
    sudo ./install.sh
    ```

5.  **Follow the Prompts:**
    The script will guide you through configuring the environment, including domain details and a secure password for the MongoDB database.

### Manual Management
After the initial deployment, you can manage the stack from the deployment directory (`/srv/avina`) using standard Docker Compose commands.

-   **Start all services:**
    ```bash
    docker compose up -d
    ```

-   **Stop all services:**
    ```bash
    docker compose down
    ```

-   **View logs:**
    ```bash
    docker compose logs -f
    ```

## Security

-   **Least Privilege:** The setup creates a dedicated `avina-admins` group for file permissions and relies on the `docker` group for container management, avoiding widespread `sudo` access.
-   **Secrets Management:** All sensitive values are managed in a `.env` file on the server, generated by the installer. This file should never be committed to version control.
-   **CRITICAL WARNING:** Users in the `docker` group have permissions equivalent to root on the host machine. Only add fully trusted administrators.
